# README

[Описание задачи](https://docs.google.com/document/d/174KhzX4EVqHIJV6GiWskP1KkhYUS_JeJa8WS6tgIwYY/edit#heading=h.sj9glk599oik)


## Рабочий процесс создания данных для модели. Вариант 1.

1. **Создание объекта на базе ProstheticHandDataProcessor**  
   Начните с создания объекта, используя класс `ProstheticHandDataProcessor`.

   Пример использования:
   ```python

    processor = ProstheticHandDataProcessor(
                                palm_file, # Список файлов с данными
                                pilote_id = pilote_id,# id пилота 
                                n_omg_channels=50, # количество каналов данных в файле
                                n_acc_channels=3, # количество каналов акселометра
                                n_gyr_channels=3, # количество каналов гироскопа
                                n_enc_channels=6, # количество кодированных каналов
                                n_mag_channels=0)
   ```

2. **Использование метода `vectors_cousine()` для сбора данных**  
   Метод `vectors_cousine()` не принимает входных параметров. В результате работы метода изменяется содержимое двух переменных внутри объекта: 
   - `vectors`, которая хранит данные в формате словаря: `[сенсор][жест][шаг] -> вектор`, 
   - `vectors_sum`, которая хранит данные в формате словаря: `[сенсор] -> среднее векторное сходство между всеми векторами данного сенсора`.

3. **Применение метода `change_params_and_apply()`**  
   Метод принимает на вход следующие параметры: 
   - нижний уровень косинусной схожести для основного датасета, 
   - порог для фильтрации сенсоров по мощности сигнала, 
   - нижний уровень косинусной схожести для дополнительно рассчитанного датасета, 
   - смещение для начала и окончания рассчитанного жеста.  
   Метод ничего не возвращает, обновляет данные смещения и рассчитывает сильные признаки, которые затем будут поданы в модель.


4. **Получение X и y для моделирования**  
   Далее, из объекта с использованием метода `model_data_prepare` мы можем получить `X` и `y` для последующего использования в моделировании.

   Пример использования:
   ```python
    processor.vectors_cousine()
    processor.change_params_and_apply(0.9935822256469482,25,.95,(0,0))

    X,X_init,y = processor.model_data_prepare(True)
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    ```


<span style="color:red">Данный вариант подходит, если мы хотим получить сильные признаки и получить данные для модели.</span>



## Рабочий процесс создания данных для модели. Вариант 2

1. **Создание объекта на базе ProstheticHandDataProcessor**  
   Начните с создания объекта, используя класс `ProstheticHandDataProcessor`.

2. **Использование метода `vectors_cousine()` для сбора данных**  
   Метод `vectors_cousine()` не принимает входных параметров. В результате работы метода изменяется содержимое двух переменных внутри объекта: 
   - `vectors`, которая хранит данные в формате словаря: `[сенсор][жест][шаг] -> вектор`, 
   - `vectors_sum`, которая хранит данные в формате словаря: `[сенсор] -> среднее векторное сходство между всеми векторами данного сенсора`.

3. **Применение метода `change_params_and_apply()`**  
   Метод принимает на вход следующие параметры: 
   - нижний уровень косинусной схожести для основного датасета, 
   - порог для фильтрации сенсоров по мощности сигнала, 
   - нижний уровень косинусной схожести для дополнительно рассчитанного датасета, 
   - смещение для начала и окончания рассчитанного жеста.  
   Метод ничего не возвращает, обновляет данные смещения и рассчитывает сильные признаки, которые затем будут поданы в модель.

4. **Полуавтоматизация процесса**  
   Мы можем полуавтоматизировать процесс, используя метод `processor.get_cosine_steps`, который вернет список значений косинусного сходства для основного датасета. Это позволит на каждом шаге добавлять или убирать по одному признаку в порядке его значимости для модели.

5. **Использование метода `fit_and_predict()`**  
   Мы используем метод `fit_and_predict`, куда передаем следующие параметры:
   - `id` пилота,
   - тип модели: `rf` или `lgb`,
   - параметры модели,
   - параметры отбора признаков,
   - использовать ли дополнительно созданные признаки,
   - файл статистики, куда будет сохранена статистика.

   Пример использования:
   ```python

    processor.vectors_cousine()
    processor.change_params_and_apply(0.9935822256469482,25,.95,(0,0))
    steps = processor.get_cosine_steps(15)[:-3]

    selection_params = {
        'cosine': 0,
        'sensor_power': 25,
        'cosine_add_feature_1': .999,
        'shift': (0, 0)
    }

    lgb_params = {
        'n_estimators': 2000,         # Количество деревьев
        'learning_rate': 0.1,         # Скорость обучения
        'max_depth': -1,              # Максимальная глубина деревьев (по умолчанию нет ограничений)
        'min_child_samples': 20,      # Минимальное число образцов в листьях
        'subsample': 0.8,             # Доля выборки для обучения каждого дерева
        'random_state': 42            # Для воспроизводимости
    }

    for step in steps:
        selection_params['cosine'] = step
        processor.fit_and_predict(pilote_id, 'lgb', lgb_params, selection_params, use_add=False, stat_file='st.json')
    ```     

<span style="color:red">Данный вариант подходит, если мы хотим запустить механизм поиска лучших параметров и записать их результаты, с последующим использованием для поиска лучших параметров.</span>



## Статистика

Метод `processor.get_min_max_stat_for_pilote` позволяет получить минимальные и максимальные статистические значения для определенного пилота.

#### Входные параметры
- `pd.dataframe`: На базе файла статистики.
- `id пилота`: Уникальный идентификатор пилота.

#### Выходные параметры
Метод возвращает статистику для данного пилота, включая:
- тип модели
- id записи, где хранятся данные для минимального и максимального результата работы модели.

#### Пример использования
```python
processor.get_min_max_stat_for_pilote(pd.read_json('st.json'), pilote_id)

{
    'rf': {
        'min': 0.8437497953518519,
        'min_id': 101,
        'max': 0.9510481419555555,
        'max_id': 91
    }
}
```

### Получение результатов модели по ID

Метод `processor.get_statistic_by_id` позволяет получить результаты модели для определенной записи по её ID.

#### Пример использования
```python
processor.get_statistic_by_id(pd.read_json('st.json'), 56)
```


### Получение параметров модели по ID

Метод `processor.get_model_params_by_id` позволяет получить параметры модели для определенной записи по её ID.

#### Входные параметры
- `<stat>`: Статистика, полученная с помощью метода `get_stat`.
- `<record id>`: Уникальный идентификатор записи.

#### Необходимый шаг перед использованием
Сначала необходимо получить статистику, используя метод `get_stat`:

```python
stat = processor.get_stat('st.json')
```
#### Пример использования
```python
model_params = processor.get_model_params_by_id(stat, 91)

{
    'rf': {
        'n_estimators': 100,
        'max_depth': 40,
        'min_samples_split': 5,
        'min_samples_leaf': 3,
        'max_features': 'log2',
        'random_state': 42
    }
}

```

### Получение параметров отбора признаков по ID

Метод `processor.get_params_by_id` позволяет получить параметры отбора признаков для определенной записи по её ID.

#### Входные параметры
- `<stat>`: Статистика, полученная с помощью метода `get_stat`.
- `<record id>`: Уникальный идентификатор записи.

#### Необходимый шаг перед использованием
Сначала необходимо получить статистику, используя метод `get_stat`:

```python
stat = processor.get_stat('st.json')
```

#### Пример использования
```python
feature_selection_params = processor.get_params_by_id(stat, 91)

{
    'cosine': 0.9,
    'sensor_power': 25,
    'cosine_add_feature_1': 0.999,
    'shift': (0, 0)
    ...
}

```

## Графики

Для созданной модели (в случае использования варианта 1) можно посмотреть изначальный вариант данных и вариант работы алгоритма смещения.

Метод `graph_sensor_gestures` позволяет визуализировать данные в зависимости от выбранного типа.

#### Входные параметры
- `<range>`: Диапазон значений для отображения графика.
- `<тип>`: 
  - `1` - изначальный вид, без смещения.
  - `2` - добавляется график с визуализацией произведенного смещения.

#### Пример использования
```python
processor.graph_sensor_gestures(range(500, 1300), 2)
```

### Графическое отображение целевого значения и предсказанного

Метод `processor.plot_results` позволяет визуализировать целевое значение и предсказанное значение модели на графике.

#### Входные параметры
- `y_test`: Массив целевых значений.
- `y_pred_test`: Массив предсказанных значений.
- `<размер графика>`: Кортеж, определяющий размер графика, например, `(20, 4)`.
- `<толщина линии>`: Толщина линии на графике, например, `0.2`.

#### Пример использования
```python
processor.plot_results(y_test, y_pred_test, (20, 4), 0.2)
```


### Получение статистики для модели

В случае ручного создания модели, для того чтобы получить результаты статистики и записать их в файл статистики, необходимо применить метод для каждого набора данных (train, test, весь датасет).

#### Пример использования
```python
processor.get_statistic(y_train, y_pred_train, 1)
processor.get_statistic(y_test, y_pred_test, 2)
processor.get_statistic(y, y_pred_train_init, 3)
```